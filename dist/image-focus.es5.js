function assignStyles(t,i){for(var e in i)t.style[e]=i[e]}function firstNumberIn(t){return t.map(function(t){return"string"==typeof t?parseFloat(t):t}).find(function(t){return"number"==typeof t})}function debounce(t,i){function e(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];n&&clearTimeout(n),n=setTimeout(function(){return t.apply(void 0,e)},i)}var n;return e}function initFocusedImage(t){return new FocusedImage(t)}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},writable:!0,configurable:!0}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),e=i.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<e;){var s=i[o];if(t.call(n,s,o,i))return s;o++}}});var noop=function(){},retina="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPHRpdGxlPkVsbGlwc2U8L3RpdGxlPgo8ZGVzYz5DcmVhdGVkIHVzaW5nIEZpZ21hPC9kZXNjPgo8ZyBpZD0iQ2FudmFzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTEgLTI0NzUpIj4KPGcgaWQ9IkVsbGlwc2UiPgo8dXNlIHhsaW5rOmhyZWY9IiNwYXRoMF9maWxsIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzExIDI0NzUpIiBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8bWFzayBpZD0ibWFzazBfb3V0bGluZV9pbnMiPgo8dXNlIHhsaW5rOmhyZWY9IiNwYXRoMF9maWxsIiBmaWxsPSJ3aGl0ZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTMxMSAyNDc1KSIvPgo8L21hc2s+CjxnIG1hc2s9InVybCgjbWFzazBfb3V0bGluZV9pbnMpIj4KPHVzZSB4bGluazpocmVmPSIjcGF0aDFfc3Ryb2tlXzJ4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzExIDI0NzUpIiBmaWxsPSIjRkZGRkZGIiBmaWxsLW9wYWNpdHk9IjAuOCIvPgo8L2c+CjwvZz4KPC9nPgo8ZGVmcz4KPHBhdGggaWQ9InBhdGgwX2ZpbGwiIGQ9Ik0gMjAgMTBDIDIwIDE1LjUyMjggMTUuNTIyOCAyMCAxMCAyMEMgNC40NzcxNSAyMCAwIDE1LjUyMjggMCAxMEMgMCA0LjQ3NzE1IDQuNDc3MTUgMCAxMCAwQyAxNS41MjI4IDAgMjAgNC40NzcxNSAyMCAxMFoiLz4KPHBhdGggaWQ9InBhdGgxX3N0cm9rZV8yeCIgZD0iTSAxOCAxMEMgMTggMTQuNDE4MyAxNC40MTgzIDE4IDEwIDE4TCAxMCAyMkMgMTYuNjI3NCAyMiAyMiAxNi42Mjc0IDIyIDEwTCAxOCAxMFpNIDEwIDE4QyA1LjU4MTcyIDE4IDIgMTQuNDE4MyAyIDEwTCAtMiAxMEMgLTIgMTYuNjI3NCAzLjM3MjU4IDIyIDEwIDIyTCAxMCAxOFpNIDIgMTBDIDIgNS41ODE3MiA1LjU4MTcyIDIgMTAgMkwgMTAgLTJDIDMuMzcyNTggLTIgLTIgMy4zNzI1OCAtMiAxMEwgMiAxMFpNIDEwIDJDIDE0LjQxODMgMiAxOCA1LjU4MTcyIDE4IDEwTCAyMiAxMEMgMjIgMy4zNzI1OCAxNi42Mjc0IC0yIDEwIC0yTCAxMCAyWiIvPgo8L2RlZnM+Cjwvc3ZnPg==",IMAGE_STYLES={display:"block",maxWidth:"100%"},CONTAINER_STYLES={position:"relative",overflow:"hidden",userSelect:"none"},RETINA_STYLES={position:"absolute",cursor:"move"},DEFAULT_OPTIONS={onChange:noop},FocusPicker=function(){function t(t,i){var e=this;this.calculateOffsetFromFocus=function(){var t=e.img.getBoundingClientRect(),i=t.width,n=t.height;return{offsetX:i*(e.focusX/2+.5),offsetY:n*(e.focusY/-2+.5)}},this.updateRetinaPosition=function(t){e.retina.style.top="calc("+t.offsetY+"px - 10px)",e.retina.style.left="calc("+t.offsetX+"px - 10px)"},this.setFocus=function(t,i){e.focusX=t,e.focusY=i,e.updateRetinaPosition(e.calculateOffsetFromFocus())},this.startDragging=function(t){e.isDragging=!0,e.handleDrag(t)},this.stopDragging=function(){e.isDragging=!1},this.handleDrag=function(t){if(e.isDragging){var i=e.img.getBoundingClientRect(),n=i.width,o=i.height,s=i.left,a=i.top,r=t.clientX-s,c=t.clientY-a,u=2*(r/n-.5),g=-2*(c/o-.5);e.updateRetinaPosition({offsetX:r,offsetY:c}),e.img.setAttribute("data-focus-x",u.toString()),e.img.setAttribute("data-focus-y",g.toString()),e.options.onChange(u,g)}},this.options=Object.assign(DEFAULT_OPTIONS,i),this.setUpElementReferences(t),this.bindContainerEvents(),this.setUpImageAttributes(),this.assignStyles(),this.initailizeFocusCoordinates(),setTimeout(function(){return e.updateRetinaPosition(e.calculateOffsetFromFocus())},0)}return t.prototype.assignStyles=function(){assignStyles(this.img,IMAGE_STYLES),assignStyles(this.retina,RETINA_STYLES),assignStyles(this.container,CONTAINER_STYLES)},t.prototype.initailizeFocusCoordinates=function(){this.focusX=firstNumberIn([this.options.focus&&this.options.focus.x,this.img.getAttribute("data-focus-x"),0]),this.focusY=firstNumberIn([this.options.focus&&this.options.focus.y,this.img.getAttribute("data-focus-y"),0])},t.prototype.setUpElementReferences=function(t){if("IMG"===t.nodeName)this.img=t,this.container=t.parentElement;else if(this.container=t,this.img=t.querySelector("img"),!this.img)throw console.error(t),new Error("No image found within above container");this.retina=document.createElement("img"),this.retina.src=retina,this.retina.draggable=!1,this.container.appendChild(this.retina)},t.prototype.bindContainerEvents=function(){this.container.onmousedown=this.startDragging,this.container.onmouseup=this.stopDragging,this.container.onmouseleave=this.stopDragging,this.container.onmousemove=this.handleDrag},t.prototype.setUpImageAttributes=function(){var t=this;this.img.draggable=!1,this.img.onload=function(){t.updateRetinaPosition(t.calculateOffsetFromFocus())}},t}(),IMG_STYLES={minHeight:"100%",minWidth:"100%",position:"absolute",top:"0",right:"0",bottom:"0",left:"0"},CONTAINER_STYLES$1={position:"relative",overflow:"hidden"},DEFAULT_OPTIONS$1={debounceTime:17,updateOnWindowResize:!0},FocusedImage=function(){function t(t,i){var e=this;this.initializationNode=t,this.setFocus=function(t,i){e.setFocusAttributes(t,i),e.applyShift()},this.applyShift=function(){if(e.hasReferences()){e.checkForStaticPosition();var t=e.img.naturalWidth,i=e.img.naturalHeight,n=e.container.getBoundingClientRect().width,o=e.container.getBoundingClientRect().height,s=parseFloat(e.img.getAttribute("data-focus-x")),a=parseFloat(e.img.getAttribute("data-focus-y")),r="0",c="0";if(!(n>0&&o>0&&t>0&&i>0))return!1;var u=t/n,g=i/o;e.img.style.maxHeight=null,e.img.style.maxWidth=null,t>n&&i>o&&(e.img.style[u>g?"maxHeight":"maxWidth"]="100%"),u>g?r=e.calcShift(g,n,t,s):u<g&&(c=e.calcShift(u,o,i,a,!0)),e.img.style.top=c,e.img.style.left=r}},this.setFocusAttributes=function(t,i){e.img.setAttribute("data-focus-x",t.toString()),e.img.setAttribute("data-focus-y",i.toString())},this.options=Object.assign(DEFAULT_OPTIONS$1,i),this.setUpElementReferences(t),this.setUpStyles(),this.debounceApplyShift=debounce(this.applyShift,this.options.debounceTime),this.options.focus&&this.setFocusAttributes(this.options.focus.x,this.options.focus.y),this.options.updateOnWindowResize&&this.startListening(),setTimeout(function(){return e.applyShift()},0)}return t.prototype.startListening=function(){this.listening||(this.listening=!0,window.addEventListener("resize",this.debounceApplyShift))},t.prototype.stopListening=function(){this.listening&&(this.listening=!1,window.removeEventListener("resize",this.debounceApplyShift))},t.prototype.setUpStyles=function(){assignStyles(this.container,CONTAINER_STYLES$1),assignStyles(this.img,IMG_STYLES)},t.prototype.checkForStaticPosition=function(){"static"===this.container.style.position&&console.warn("\nThis container has a static position. The image will not\nbe contained properly unless it has a non-static position\nsuch as 'absolute' or 'relative'.")},t.prototype.hasReferences=function(){var t=!0;return this.img||(t=!1,console.error("\nReference to image not found. Make sure the container\nhas an image inside it.\n")),this.container||(t=!1,console.error("\nReference to container not found. Not sure how that happened.\n")),t},t.prototype.setUpElementReferences=function(t){if("IMG"===t.nodeName)this.img=t,this.container=t.parentElement;else if(this.container=t,this.img=t.querySelector("img"),!this.img)throw console.error(t),new Error("No image found within above container");this.img.__focal_point_instance__&&this.img.__focal_point_instance__.stopListening(),this.img.__focal_point_instance__=this,this.img.onload=this.applyShift},t.prototype.calcShift=function(t,i,e,n,o){var s=Math.floor(i/2),a=(n+1)/2,r=Math.floor(e/t),c=Math.floor(a*r);o&&(c=r-c);var u=c-s,g=r-c,h=i-s;return g<h&&(u-=h-g),u<0&&(u=0),-100*u/i+"%"},t}();export{FocusPicker,FocusedImage,initFocusedImage};
//# sourceMappingURL=image-focus.es5.js.map
